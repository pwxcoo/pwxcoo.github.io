<!DOCTYPE html>
<html lang=en>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <!-- fix Sina weibo image host temporarily -->
    <meta name="referrer" content="no-referrer" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="红黑树，AVL 树，B&#x2F;B+ 树这三个树很经典，之前一直都想手动实现。今天撸了一下红黑树，说实话红黑树比我之前写 AVL 树繁琐多了，看着别人的代码，修修补补也弄了我好久。。 红黑树的介绍Red-Black Tree，就是一个特殊的二叉查找树，AVL 通过自调整树高度来保证数据操作控制在 O(logn) ，红黑树则通过颜色来变相调整高度来保证时间复杂度不会退化成链表。 很多地方都应用了红黑树，Ja">
<meta property="og:type" content="website">
<meta property="og:title" content="红黑树的实现">
<meta property="og:url" content="https://blog.pwxcoo.com/archive/%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E5%AE%9E%E7%8E%B0.html">
<meta property="og:site_name" content="PWXCOO">
<meta property="og:description" content="红黑树，AVL 树，B&#x2F;B+ 树这三个树很经典，之前一直都想手动实现。今天撸了一下红黑树，说实话红黑树比我之前写 AVL 树繁琐多了，看着别人的代码，修修补补也弄了我好久。。 红黑树的介绍Red-Black Tree，就是一个特殊的二叉查找树，AVL 通过自调整树高度来保证数据操作控制在 O(logn) ，红黑树则通过颜色来变相调整高度来保证时间复杂度不会退化成链表。 很多地方都应用了红黑树，Ja">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-03-02T10:35:17.000Z">
<meta property="article:modified_time" content="2022-03-24T05:48:48.890Z">
<meta property="article:author" content="pwxcoo">
<meta property="article:tag" content="algorithm">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>红黑树的实现</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="PWXCOO" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body class="max-width mx-auto px3 ">
    
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="content index py4">
        
          <header id="header">
  <a href="/">
  
    
      <div id="logo" style="background-image: url(/images/logo.png);"></div>
    
  
    <div id="title">
      <h1>PWXCOO</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/archives/">Archives</a></li>
       
        <li><a href="/toc/">Toc</a></li>
       
        <li><a href="/about/">About</a></li>
      
    </ul>
  </div>
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <p>红黑树，AVL 树，B/B+ 树这三个树很经典，之前一直都想手动实现。今天撸了一下红黑树，说实话红黑树比我之前写 AVL 树繁琐多了，看着别人的代码，修修补补也弄了我好久。。</p>
<h1 id="红黑树的介绍"><a href="#红黑树的介绍" class="headerlink" title="红黑树的介绍"></a>红黑树的介绍</h1><p>Red-Black Tree，就是一个特殊的二叉查找树，AVL 通过自调整树高度来保证数据操作控制在 O(logn) ，红黑树则通过颜色来变相调整高度来保证时间复杂度不会退化成链表。</p>
<p>很多地方都应用了红黑树，Java 里的 TreeMap, C++ 里的 map， linux 里的进程调度都用到了红黑树。</p>
<p>5 个特性: </p>
<ol>
<li>每个节点或者是黑色，或者是红色。</li>
<li>根节点是黑色。</li>
<li>每个叶子节点是黑色。 [注意: 这里叶子节点，是指为空的叶子节点！]</li>
<li>如果一个节点是红色的，则它的子节点必须是黑色的。</li>
<li>从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点。</li>
</ol>
<h1 id="红黑树的-Java-实现"><a href="#红黑树的-Java-实现" class="headerlink" title="红黑树的 Java 实现"></a>红黑树的 Java 实现</h1><p>基本操作就是旋转，添加和删除。红黑树结点就是一个二叉树结点加上一个颜色和一个指向父结点的指针。</p>
<h2 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h2><p>旋转就是左旋和右旋。</p>
<p>左旋。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * 对红黑树的节点(x)进行左旋转</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 左旋示意图(对节点x进行左旋): </span></span><br><span class="line"><span class="comment"> *      px                              px</span></span><br><span class="line"><span class="comment"> *     /                               /</span></span><br><span class="line"><span class="comment"> *    x                               y                </span></span><br><span class="line"><span class="comment"> *   /  \      --(左旋)-.            / \                #</span></span><br><span class="line"><span class="comment"> *  lx   y                          x  ry     </span></span><br><span class="line"><span class="comment"> *     /   \                       /  \</span></span><br><span class="line"><span class="comment"> *    ly   ry                     lx  ly  </span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></p>
<p>右旋。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * 对红黑树的节点(y)进行右旋转</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 右旋示意图(对节点y进行左旋): </span></span><br><span class="line"><span class="comment"> *            py                               py</span></span><br><span class="line"><span class="comment"> *           /                                /</span></span><br><span class="line"><span class="comment"> *          y                                x                  </span></span><br><span class="line"><span class="comment"> *         /  \      --(右旋)-.             /  \                     #</span></span><br><span class="line"><span class="comment"> *        x   ry                           lx   y  </span></span><br><span class="line"><span class="comment"> *       / \                                   / \                   #</span></span><br><span class="line"><span class="comment"> *      lx  rx                                rx  ry</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure></p>
<h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><ol>
<li>将红黑树当作一颗二叉查找树，将节点插入。</li>
<li>将插入的节点着色为”红色”。</li>
<li>通过一系列的旋转或着色等操作，使之重新成为一颗红黑树。</li>
</ol>
<p>此时当插入结点的父结点为红色的时候，违背了规则 4<code>如果一个节点是红色的，则它的子节点必须是黑色的</code>，需要调整。此时祖父结点必为黑色，又可以分成 3 种情况来调整。</p>
<p><code>now 为当前插入的结点，B 为黑色结点，R 为红色结点。</code></p>
<ol>
<li>叔叔结点为红色，直接把父结点和叔叔结点变成黑色就可以了，祖父结点编程红色，然后 now 变成祖父结点继续向上递归。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*           py                               py</span><br><span class="line">*           /                                /</span><br><span class="line">*          B                                R                  </span><br><span class="line">*         /  \                            /  \                     </span><br><span class="line">*        R    R                          B    B  </span><br><span class="line">*       /                               /                       </span><br><span class="line">*      now                             now</span><br></pre></td></tr></table></figure></li>
<li>叔叔结点是黑色，当前结点是父结点的右孩子。左旋父结点，然后 now 变成之前原来的父结点。的使其变成情况 3<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*           py                               py</span><br><span class="line">*           /                                /</span><br><span class="line">*          B                                B                  </span><br><span class="line">*         /  \                            /  \                     </span><br><span class="line">*        R    B          左旋parent      now   B  </span><br><span class="line">*         \                             /                      </span><br><span class="line">*         now                          R</span><br></pre></td></tr></table></figure></li>
<li>叔叔结点是黑色，当前结点是父结点的左孩子。父结点变黑，祖父结点变红，右旋祖父结点。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*           py                   py                 py</span><br><span class="line">*           /                    /                 /</span><br><span class="line">*          B                    R                 B  </span><br><span class="line">*         /  \                 /  \              / \       </span><br><span class="line">*        R    B               B    B          now   R  </span><br><span class="line">*       /                    /                       \</span><br><span class="line">*      now                  now                       B   </span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>还有右边的情况，是对称的，就不举例了。</p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ol>
<li>将红黑树当作一颗二叉查找树，将节点删除。<ul>
<li>被删除节点没有儿子，即为叶节点。那么，直接将该节点删除就OK了。</li>
<li>被删除节点只有一个儿子。那么，直接删除该节点，并用该节点的唯一子节点顶替它的位置。</li>
<li>被删除节点有两个儿子。那么，先找出它的后继节点(后继结点就是树中下一个大于这个数的数)；然后把“它的后继节点的内容”复制给“该节点的内容”；之后，删除“它的后继节点”。</li>
</ul>
</li>
<li>通过”旋转和重新着色”等一系列来修正该树，使之重新成为一棵红黑树。</li>
</ol>
<p>如果删除的结点是黑色的，则需要调整。可以分成 4 中情况来调整。</p>
<p><code>now 必为黑色</code>。</p>
<ol>
<li><p>兄弟结点为红色。兄弟结点变黑，父结点变红，左旋父结点。易得此时兄弟结点必为黑，转化成其他情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*           py              py          py</span><br><span class="line">*           /              /           /</span><br><span class="line">*          B              R           B       </span><br><span class="line">*         / \            /  \        /              </span><br><span class="line">*       now  R          now  B      R   </span><br><span class="line">*                                  /         </span><br><span class="line">*                                 now </span><br></pre></td></tr></table></figure>
</li>
<li><p>兄弟结点为黑，并且兄弟结点两个孩子也是黑的。兄弟结点变红，now 变成父结点向上递归。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">*           py              py         </span><br><span class="line">*           /              /          </span><br><span class="line">*         B/R            B/R                  </span><br><span class="line">*         / \            / \                     </span><br><span class="line">*       now  B         now  R       </span><br><span class="line">*           / \            / \               </span><br><span class="line">*          B   B          B   B       </span><br></pre></td></tr></table></figure>
</li>
<li><p>兄弟结点为黑，并且左孩子为红。左孩子变黑，兄弟结点变红，右旋兄弟结点，变成情况4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*           py              py          py</span><br><span class="line">*           /              /           /</span><br><span class="line">*         B/R            B/R         B/R       </span><br><span class="line">*         / \            /  \        /  \            </span><br><span class="line">*       now  B          now  R     now   B</span><br><span class="line">*           / \             / \           \      </span><br><span class="line">*          R   B           B   B           R</span><br><span class="line">*                                           \   </span><br><span class="line">*                                            B   </span><br></pre></td></tr></table></figure>
</li>
<li><p>兄弟结点为黑，并且右孩子为红，左孩子为任意颜色。兄弟结点改成父结点的颜色，父结点变黑，兄弟结点的右孩子变黑，左旋父结点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*           py              py             py</span><br><span class="line">*           /              /               /</span><br><span class="line">*         B/R             B              B/R       </span><br><span class="line">*         / \            /  \            /  \            </span><br><span class="line">*       now  B          now B/R         B    B</span><br><span class="line">*             \               \        /             </span><br><span class="line">*              R               B     now         </span><br><span class="line">*                                              </span><br><span class="line">*                                               </span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>还有对称的情况。其实这么多情况还是有点恶心人的。</p>
<h2 id="Java-实现"><a href="#Java-实现" class="headerlink" title="Java 实现"></a>Java 实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RBTree</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; mRoot;    <span class="comment">// 根结点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">RED</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">BLACK</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RBTNode</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">        <span class="type">boolean</span> color;  <span class="comment">// 颜色</span></span><br><span class="line">        T key;  <span class="comment">// 键值</span></span><br><span class="line">        RBTNode&lt;T&gt; left;    <span class="comment">// 左孩子</span></span><br><span class="line">        RBTNode&lt;T&gt; right;   <span class="comment">// 右孩子</span></span><br><span class="line">        RBTNode&lt;T&gt; parent;  <span class="comment">// 父结点</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">RBTNode</span><span class="params">(T key, <span class="type">boolean</span> color, RBTNode&lt;T&gt; parent, RBTNode&lt;T&gt; left, RBTNode&lt;T&gt; right)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.color = color;</span><br><span class="line">            <span class="built_in">this</span>.parent = parent;</span><br><span class="line">            <span class="built_in">this</span>.left = left;</span><br><span class="line">            <span class="built_in">this</span>.right = right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">getKey</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span> + key + (<span class="built_in">this</span>.color==RED ? <span class="string">&quot;R&quot;</span> : <span class="string">&quot;B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RBTree</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        mRoot = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; <span class="title function_">parentOf</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> node != <span class="literal">null</span> ? node.parent : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">colorOf</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> node != <span class="literal">null</span> ? node.color : BLACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isRed</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> (node != <span class="literal">null</span>) &amp;&amp; (node.color == RED) ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isBlack</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> !isRed(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setBlack</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>)</span><br><span class="line">            node.color = BLACK;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setRed</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>)</span><br><span class="line">            node.color = RED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setParent</span><span class="params">(RBTNode&lt;T&gt; node, RBTNode&lt;T&gt; parent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>)</span><br><span class="line">            node.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(RBTNode&lt;T&gt; node, <span class="type">boolean</span> color)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>)</span><br><span class="line">            node.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 前序遍历&quot;红黑树&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">(RBTNode&lt;T&gt; tree)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(tree != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.print(tree.key + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            preOrder(tree.left);</span><br><span class="line">            preOrder(tree.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preOrder</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        preOrder(mRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 中序遍历&quot;红黑树&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">(RBTNode&lt;T&gt; tree)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(tree != <span class="literal">null</span>) &#123;</span><br><span class="line">            inOrder(tree.left);</span><br><span class="line">            System.out.print(tree.key+<span class="string">&quot; &quot;</span>);</span><br><span class="line">            inOrder(tree.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        inOrder(mRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 后序遍历&quot;红黑树&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">(RBTNode&lt;T&gt; tree)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(tree != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            postOrder(tree.left);</span><br><span class="line">            postOrder(tree.right);</span><br><span class="line">            System.out.print(tree.key+<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * (递归实现)查找&quot;红黑树x&quot;中键值为key的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; <span class="title function_">search</span><span class="params">(RBTNode&lt;T&gt; x, T key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (x==<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">cmp</span> <span class="operator">=</span> key.compareTo(x.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> search(x.left, key);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> search(x.right, key);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RBTNode&lt;T&gt; <span class="title function_">search</span><span class="params">(T key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> search(mRoot, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * (非递归实现)查找&quot;红黑树x&quot;中键值为key的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; <span class="title function_">iterativeSearch</span><span class="params">(RBTNode&lt;T&gt; x, T key)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (x!=<span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">cmp</span> <span class="operator">=</span> key.compareTo(x.key);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                x = x.left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                x = x.right;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RBTNode&lt;T&gt; <span class="title function_">iterativeSearch</span><span class="params">(T key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iterativeSearch(mRoot, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 找结点(x)的后继结点。即，查找&quot;红黑树中数据值大于该结点&quot;的&quot;最小结点&quot;。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> RBTNode&lt;T&gt; <span class="title function_">successor</span><span class="params">(RBTNode&lt;T&gt; x)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果x存在右孩子，则&quot;x的后继结点&quot;为 &quot;以其右孩子为根的子树的最小结点&quot;。</span></span><br><span class="line">        <span class="keyword">if</span> (x.right != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> minimum(x.right);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果x没有右孩子。则x有以下两种可能: </span></span><br><span class="line">        <span class="comment">// (01) x是&quot;一个左孩子&quot;，则&quot;x的后继结点&quot;为 &quot;它的父结点&quot;。</span></span><br><span class="line">        <span class="comment">// (02) x是&quot;一个右孩子&quot;，则查找&quot;x的最低的父结点，并且该父结点要具有左孩子&quot;，找到的这个&quot;最低的父结点&quot;就是&quot;x的后继结点&quot;。</span></span><br><span class="line">        RBTNode&lt;T&gt; y = x.parent;</span><br><span class="line">        <span class="keyword">while</span> ((y!=<span class="literal">null</span>) &amp;&amp; (x==y.right)) &#123;</span><br><span class="line">            x = y;</span><br><span class="line">            y = y.parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 找结点(x)的前驱结点。即，查找&quot;红黑树中数据值小于该结点&quot;的&quot;最大结点&quot;。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> RBTNode&lt;T&gt; <span class="title function_">predecessor</span><span class="params">(RBTNode&lt;T&gt; x)</span> &#123;</span><br><span class="line">        <span class="comment">// 如果x存在左孩子，则&quot;x的前驱结点&quot;为 &quot;以其左孩子为根的子树的最大结点&quot;。</span></span><br><span class="line">        <span class="keyword">if</span> (x.left != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> maximum(x.left);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果x没有左孩子。则x有以下两种可能: </span></span><br><span class="line">        <span class="comment">// (01) x是&quot;一个右孩子&quot;，则&quot;x的前驱结点&quot;为 &quot;它的父结点&quot;。</span></span><br><span class="line">        <span class="comment">// (01) x是&quot;一个左孩子&quot;，则查找&quot;x的最低的父结点，并且该父结点要具有右孩子&quot;，找到的这个&quot;最低的父结点&quot;就是&quot;x的前驱结点&quot;。</span></span><br><span class="line">        RBTNode&lt;T&gt; y = x.parent;</span><br><span class="line">        <span class="keyword">while</span> ((y!=<span class="literal">null</span>) &amp;&amp; (x==y.left)) &#123;</span><br><span class="line">            x = y;</span><br><span class="line">            y = y.parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 查找最小结点: 返回tree为根结点的红黑树的最小结点。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; <span class="title function_">minimum</span><span class="params">(RBTNode&lt;T&gt; tree)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tree == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(tree.left != <span class="literal">null</span>)</span><br><span class="line">            tree = tree.left;</span><br><span class="line">        <span class="keyword">return</span> tree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">minimum</span><span class="params">()</span> &#123;</span><br><span class="line">        RBTNode&lt;T&gt; p = minimum(mRoot);</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> p.key;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 查找最大结点: 返回tree为根结点的红黑树的最大结点。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> RBTNode&lt;T&gt; <span class="title function_">maximum</span><span class="params">(RBTNode&lt;T&gt; tree)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tree == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(tree.right != <span class="literal">null</span>)</span><br><span class="line">            tree = tree.right;</span><br><span class="line">        <span class="keyword">return</span> tree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">maximum</span><span class="params">()</span> &#123;</span><br><span class="line">        RBTNode&lt;T&gt; p = maximum(mRoot);</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> p.key;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        postOrder(mRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 对红黑树的节点(x)进行左旋转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 左旋示意图(对节点x进行左旋): </span></span><br><span class="line"><span class="comment">     *      px                              px</span></span><br><span class="line"><span class="comment">     *     /                               /</span></span><br><span class="line"><span class="comment">     *    x                               y</span></span><br><span class="line"><span class="comment">     *   /  \      --(左旋)-.             / \                #</span></span><br><span class="line"><span class="comment">     *  lx   y                           x  ry</span></span><br><span class="line"><span class="comment">     *     /   \                        /  \</span></span><br><span class="line"><span class="comment">     *    ly   ry                      lx  ly</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">leftRotate</span><span class="params">(RBTNode&lt;T&gt; x)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// x 的右结点</span></span><br><span class="line">        RBTNode&lt;T&gt; y = x.right;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// y 的左孩子给 x 做右孩子</span></span><br><span class="line">        x.right = y.left;</span><br><span class="line">        <span class="keyword">if</span>(y.left != <span class="literal">null</span>)</span><br><span class="line">            y.left.parent = x;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x 的 parent 给 y 做 parent</span></span><br><span class="line">        y.parent = x.parent;</span><br><span class="line">        <span class="keyword">if</span>(x.parent == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.mRoot = y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(x.parent.left == x)</span><br><span class="line">                x.parent.left = y;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                x.parent.right = y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x 做 y 的左孩子</span></span><br><span class="line">        y.left = x;</span><br><span class="line">        x.parent = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 对红黑树的节点(y)进行右旋转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 右旋示意图(对节点y进行左旋): </span></span><br><span class="line"><span class="comment">     *            py                               py</span></span><br><span class="line"><span class="comment">     *           /                                /</span></span><br><span class="line"><span class="comment">     *          y                                x</span></span><br><span class="line"><span class="comment">     *         /  \      --(右旋)-.             /  \                     #</span></span><br><span class="line"><span class="comment">     *        x   ry                           lx   y</span></span><br><span class="line"><span class="comment">     *       / \                                   / \                   #</span></span><br><span class="line"><span class="comment">     *      lx  rx                                rx  ry</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rightRotate</span><span class="params">(RBTNode&lt;T&gt; y)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// x 是 y 的左结点</span></span><br><span class="line">        RBTNode&lt;T&gt; x = y.left;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// x 的右孩子给 y 做左孩子</span></span><br><span class="line">        y.left = x.right;</span><br><span class="line">        <span class="keyword">if</span>(x.right != <span class="literal">null</span>)</span><br><span class="line">            x.right.parent = y;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// y 的 parent 给 x 做 parent</span></span><br><span class="line">        x.parent = y.parent;</span><br><span class="line">        <span class="keyword">if</span>(y.parent == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.mRoot = x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(y.parent.left == y)</span><br><span class="line">                y.parent.left = x;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                y.parent.right = x;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// y 给 x 做右孩子</span></span><br><span class="line">        y.parent = x;</span><br><span class="line">        x.right = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 将结点插入到红黑树中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     node 插入的结点        // 对应《算法导论》中的node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> cmp;</span><br><span class="line">        RBTNode&lt;T&gt; y = <span class="literal">null</span>;</span><br><span class="line">        RBTNode&lt;T&gt; x = <span class="built_in">this</span>.mRoot;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把结点插入二叉查找树</span></span><br><span class="line">        <span class="keyword">while</span>(x != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            y = x;</span><br><span class="line">            cmp = node.key.compareTo(y.key);</span><br><span class="line">            <span class="keyword">if</span>(cmp &lt; <span class="number">0</span>)</span><br><span class="line">                x = x.left;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                x = x.right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        node.parent = y;</span><br><span class="line">        <span class="keyword">if</span>(y != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cmp = node.key.compareTo(y.key);</span><br><span class="line">            <span class="keyword">if</span>(cmp &lt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                y.left = node;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                y.right = node;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">this</span>.mRoot = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        node.color = RED;</span><br><span class="line"></span><br><span class="line">        insertFixUp(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 新建结点(key)，并将其插入到红黑树中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     key 插入结点的键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(T key)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RBTNode&lt;T&gt; node = <span class="keyword">new</span> <span class="title class_">RBTNode</span>&lt;&gt;(key, BLACK, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(node != <span class="literal">null</span>)</span><br><span class="line">            insert(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 红黑树插入修正函数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 在向红黑树中插入节点之后(失去平衡)，再调用该函数；</span></span><br><span class="line"><span class="comment">     * 目的是将它重新塑造成一颗红黑树。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     node 插入的结点        // 对应《算法导论》中的z</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertFixUp</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RBTNode&lt;T&gt; parent, gparent;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 若“父结点存在，并且父结点是红色的”</span></span><br><span class="line">        <span class="keyword">while</span>(((parent = parentOf(node)) != <span class="literal">null</span>) &amp;&amp; isRed(parent))</span><br><span class="line">        &#123;</span><br><span class="line">            gparent = parentOf(parent);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 若父结点是祖父结点的左孩子</span></span><br><span class="line">            <span class="keyword">if</span>(parent == gparent.left)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Case1: 叔叔结点是红色</span></span><br><span class="line">                RBTNode&lt;T&gt; uncle = gparent.right;</span><br><span class="line">                <span class="keyword">if</span>(uncle != <span class="literal">null</span> &amp;&amp; isRed(uncle))</span><br><span class="line">                &#123;</span><br><span class="line">                    setBlack(uncle);</span><br><span class="line">                    setBlack(parent);</span><br><span class="line">                    setRed(gparent);</span><br><span class="line">                    node = gparent;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Case2: 叔叔是黑色，当前结点是右孩子</span></span><br><span class="line">                <span class="keyword">if</span>(parent.right == node)</span><br><span class="line">                &#123;</span><br><span class="line">                    RBTNode&lt;T&gt; tmp;</span><br><span class="line">                    leftRotate(parent);</span><br><span class="line">                    tmp = parent;</span><br><span class="line">                    parent = node;</span><br><span class="line">                    node = tmp;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Case3: 叔叔是黑色，当前结点是左孩子</span></span><br><span class="line">                setBlack(parent);</span><br><span class="line">                setRed(gparent);</span><br><span class="line">                rightRotate(gparent);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 父结点是祖父结点的右孩子</span></span><br><span class="line">                <span class="comment">// Case1: 叔叔结点是红色</span></span><br><span class="line">                RBTNode&lt;T&gt; uncle = gparent.left;</span><br><span class="line">                <span class="keyword">if</span> (uncle != <span class="literal">null</span> &amp;&amp; isRed(uncle)) &#123;</span><br><span class="line">                    setBlack(uncle);</span><br><span class="line">                    setBlack(parent);</span><br><span class="line">                    setRed(gparent);</span><br><span class="line">                    node = gparent;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Case2: 叔叔结点是黑色，当前结点是左孩子</span></span><br><span class="line">                <span class="keyword">if</span> (parent.left == node) &#123;</span><br><span class="line">                    RBTNode&lt;T&gt; tmp;</span><br><span class="line">                    rightRotate(parent);</span><br><span class="line">                    tmp = parent;</span><br><span class="line">                    parent = node;</span><br><span class="line">                    node = tmp;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Case3: 叔叔结点是黑色，当前结点是右孩子</span></span><br><span class="line">                setBlack(parent);</span><br><span class="line">                setRed(gparent);</span><br><span class="line">                leftRotate(gparent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将根结点设为黑色</span></span><br><span class="line">        setBlack(<span class="built_in">this</span>.mRoot);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 删除结点(node)，并返回被删除的结点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     node 删除的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(RBTNode&lt;T&gt; node)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RBTNode&lt;T&gt; child, parent;</span><br><span class="line">        <span class="type">boolean</span> color;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 被删除的结点左右结点都不为空</span></span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="literal">null</span> &amp;&amp; node.right != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 后继结点取代该结点，然后删除后继结点</span></span><br><span class="line">            RBTNode&lt;T&gt; replace = node;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取后继结点</span></span><br><span class="line">            replace = replace.right;</span><br><span class="line">            <span class="keyword">while</span>(replace.left != <span class="literal">null</span>)</span><br><span class="line">                replace = replace.left;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 更改 parent 的指针</span></span><br><span class="line">            <span class="keyword">if</span>(parentOf(node) != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(parentOf(node).left == node)</span><br><span class="line">                &#123;</span><br><span class="line">                    parentOf(node).left = replace;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    parentOf(node).right = replace;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">this</span>.mRoot = replace;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把后继结点的右孩子给后继结点的 parent 做左孩子，删除后继结点</span></span><br><span class="line">            child = replace.right;</span><br><span class="line">            parent = parentOf(replace);</span><br><span class="line">            color = colorOf(replace);</span><br><span class="line">            <span class="keyword">if</span>(parent == node)</span><br><span class="line">            &#123;</span><br><span class="line">                parent = replace;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(child != <span class="literal">null</span>)</span><br><span class="line">                    setParent(child, parent);</span><br><span class="line">                parent.left = child;</span><br><span class="line"></span><br><span class="line">                replace.right = node.right;</span><br><span class="line">                setParent(node.right, replace);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 用 replace 替换 node</span></span><br><span class="line">            replace.parent = node.parent;</span><br><span class="line">            replace.color = node.color;</span><br><span class="line">            replace.left = node.left;</span><br><span class="line">            node.left.parent = replace;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 被删除的要是黑色结点，需要调整红黑树</span></span><br><span class="line">            <span class="keyword">if</span>(color == BLACK)</span><br><span class="line">                removeFixUp(child, parent);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            node = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得孩子</span></span><br><span class="line">        <span class="keyword">if</span>(node.left != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            child = node.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            child = node.right;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用孩子替换</span></span><br><span class="line">        parent = node.parent;</span><br><span class="line">        color = node.color;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(child != <span class="literal">null</span>)</span><br><span class="line">            child.parent = parent;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parent != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.left == node)</span><br><span class="line">                parent.left = child;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                parent.right = child;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.mRoot = child;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除要是黑色结点，调整红黑树</span></span><br><span class="line">        <span class="keyword">if</span>(color == BLACK)</span><br><span class="line">            removeFixUp(child, parent);</span><br><span class="line">        node = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 删除结点(z)，并返回被删除的结点</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     tree 红黑树的根结点</span></span><br><span class="line"><span class="comment">     *     z 删除的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(T key)</span> &#123;</span><br><span class="line">        RBTNode&lt;T&gt; node;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((node = search(mRoot, key)) != <span class="literal">null</span>)</span><br><span class="line">            remove(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 红黑树删除修正函数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 在从红黑树中删除插入节点之后(红黑树失去平衡)，再调用该函数；</span></span><br><span class="line"><span class="comment">     * 目的是将它重新塑造成一颗红黑树。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 参数说明: </span></span><br><span class="line"><span class="comment">     *     node 待修正的节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">removeFixUp</span><span class="params">(RBTNode&lt;T&gt; node, RBTNode&lt;T&gt; parent)</span></span><br><span class="line">    &#123;</span><br><span class="line">        RBTNode&lt;T&gt; other;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((node == <span class="literal">null</span> || isBlack(node)) &amp;&amp; node != <span class="built_in">this</span>.mRoot)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.left == node) <span class="comment">// 待修正结点是左孩子</span></span><br><span class="line">            &#123;</span><br><span class="line">                other = parent.right;</span><br><span class="line">                <span class="comment">// Case1: x 的兄弟是红色的</span></span><br><span class="line">                <span class="keyword">if</span>(isRed(other))</span><br><span class="line">                &#123;</span><br><span class="line">                    setBlack(other);</span><br><span class="line">                    setRed(parent);</span><br><span class="line">                    leftRotate(parent);</span><br><span class="line">                    other = parent.right;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Case2: x 的兄弟是黑色并且两个孩子也是黑色</span></span><br><span class="line">                <span class="keyword">if</span>(other.left == <span class="literal">null</span> || isBlack(other.left) &amp;&amp;</span><br><span class="line">                        (other.right == <span class="literal">null</span> || isBlack(other.right)))</span><br><span class="line">                &#123;</span><br><span class="line">                    setRed(other);</span><br><span class="line">                    node = parent;</span><br><span class="line">                    parent = parentOf(node);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// Case3: x 的兄弟是黑色，并且左孩子是红色，右孩子是黑色</span></span><br><span class="line">                    <span class="keyword">if</span>(other.right == <span class="literal">null</span> || isBlack(other.right))</span><br><span class="line">                    &#123;</span><br><span class="line">                        setBlack(other.left);</span><br><span class="line">                        setRed(other);</span><br><span class="line">                        rightRotate(other);</span><br><span class="line">                        other = parent.right;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Case4: x 的兄弟是黑色，并且右孩子是红色，左孩子是任意颜色</span></span><br><span class="line">                    setColor(other, colorOf(parent));</span><br><span class="line">                    setBlack(parent);</span><br><span class="line">                    setBlack(other.right);</span><br><span class="line">                    leftRotate(parent);</span><br><span class="line">                    node = <span class="built_in">this</span>.mRoot;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>    <span class="comment">// 待修正结点是右孩子</span></span><br><span class="line">            &#123;</span><br><span class="line">                other = parent.left;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(isRed(other))    <span class="comment">// Case1: 兄弟结点是红的</span></span><br><span class="line">                &#123;</span><br><span class="line">                    setBlack(other);</span><br><span class="line">                    setRed(parent);</span><br><span class="line">                    rightRotate(parent);</span><br><span class="line">                    other = parent.left;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 此时 other 必为 BLACK</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>((other.left == <span class="literal">null</span> || isBlack(other.left) &amp;&amp;</span><br><span class="line">                        (other.right == <span class="literal">null</span> || isBlack(other.right)))) <span class="comment">// Case2: 兄弟结点两个孩子都是黑的</span></span><br><span class="line">                &#123;</span><br><span class="line">                    setRed(other);</span><br><span class="line">                    node = parent;</span><br><span class="line">                    parent = parentOf(node);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(other.left == <span class="literal">null</span> || isBlack(other.left))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// Case3: 左孩子为黑，右孩子为红</span></span><br><span class="line">                        setBlack(other.right);</span><br><span class="line">                        setRed(other);</span><br><span class="line">                        leftRotate(other);</span><br><span class="line">                        other = parent.left;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Case4: 左孩子为红，右孩子任意颜色</span></span><br><span class="line">                    setColor(other, colorOf(parent));</span><br><span class="line">                    setBlack(parent);</span><br><span class="line">                    setBlack(other.left);</span><br><span class="line">                    rightRotate(parent);</span><br><span class="line">                    node = <span class="built_in">this</span>.mRoot;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (node!=<span class="literal">null</span>)</span><br><span class="line">            setBlack(node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 销毁红黑树</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">(RBTNode&lt;T&gt; tree)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (tree==<span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tree.left != <span class="literal">null</span>)</span><br><span class="line">            destroy(tree.left);</span><br><span class="line">        <span class="keyword">if</span> (tree.right != <span class="literal">null</span>)</span><br><span class="line">            destroy(tree.right);</span><br><span class="line"></span><br><span class="line">        tree=<span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        destroy(mRoot);</span><br><span class="line">        mRoot = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 打印&quot;红黑树&quot;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * key        -- 节点的键值</span></span><br><span class="line"><span class="comment">     * direction  --  0，表示该节点是根节点;</span></span><br><span class="line"><span class="comment">     *               -1，表示该节点是它的父结点的左孩子;</span></span><br><span class="line"><span class="comment">     *                1，表示该节点是它的父结点的右孩子。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(RBTNode&lt;T&gt; tree, T key, <span class="type">int</span> direction)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(tree != <span class="literal">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(direction==<span class="number">0</span>)    <span class="comment">// tree是根节点</span></span><br><span class="line">                System.out.printf(<span class="string">&quot;%2d(B) is root\n&quot;</span>, tree.key);</span><br><span class="line">            <span class="keyword">else</span>                <span class="comment">// tree是分支节点</span></span><br><span class="line">                System.out.printf(<span class="string">&quot;%2d(%s) is %2d&#x27;s %6s child\n&quot;</span>, tree.key, isRed(tree)?<span class="string">&quot;R&quot;</span>:<span class="string">&quot;B&quot;</span>, key, direction==<span class="number">1</span>?<span class="string">&quot;right&quot;</span> : <span class="string">&quot;left&quot;</span>);</span><br><span class="line"></span><br><span class="line">            print(tree.left, tree.key, -<span class="number">1</span>);</span><br><span class="line">            print(tree.right,tree.key,  <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mRoot != <span class="literal">null</span>)</span><br><span class="line">            print(mRoot, mRoot.key, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RBTreeTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> a[] = &#123;<span class="number">10</span>, <span class="number">40</span>, <span class="number">30</span>, <span class="number">60</span>, <span class="number">90</span>, <span class="number">70</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">80</span>&#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">mDebugInsert</span> <span class="operator">=</span> <span class="literal">false</span>;    <span class="comment">// &quot;插入&quot;动作的检测开关(false，关闭；true，打开)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">mDebugDelete</span> <span class="operator">=</span> <span class="literal">false</span>;    <span class="comment">// &quot;删除&quot;动作的检测开关(false，关闭；true，打开)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> i, ilen = a.length;</span><br><span class="line">        RBTree&lt;Integer&gt; tree=<span class="keyword">new</span> <span class="title class_">RBTree</span>&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;== 原始数据: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;ilen; i++)</span><br><span class="line">            System.out.printf(<span class="string">&quot;%d &quot;</span>, a[i]);</span><br><span class="line">        System.out.printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;ilen; i++) &#123;</span><br><span class="line">            tree.insert(a[i]);</span><br><span class="line">            <span class="comment">// 设置mDebugInsert=true,测试&quot;添加函数&quot;</span></span><br><span class="line">            <span class="keyword">if</span> (mDebugInsert) &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;== 添加节点: %d\n&quot;</span>, a[i]);</span><br><span class="line">                System.out.printf(<span class="string">&quot;== 树的详细信息: \n&quot;</span>);</span><br><span class="line">                tree.print();</span><br><span class="line">                System.out.printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;== 前序遍历: &quot;</span>);</span><br><span class="line">        tree.preOrder();</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;\n== 中序遍历: &quot;</span>);</span><br><span class="line">        tree.inOrder();</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;\n== 后序遍历: &quot;</span>);</span><br><span class="line">        tree.postOrder();</span><br><span class="line">        System.out.printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.printf(<span class="string">&quot;== 最小值: %s\n&quot;</span>, tree.minimum());</span><br><span class="line">        System.out.printf(<span class="string">&quot;== 最大值: %s\n&quot;</span>, tree.maximum());</span><br><span class="line">        System.out.printf(<span class="string">&quot;== 树的详细信息: \n&quot;</span>);</span><br><span class="line">        tree.print();</span><br><span class="line">        System.out.printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置mDebugDelete=true,测试&quot;删除函数&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (mDebugDelete) &#123;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;ilen; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                tree.remove(a[i]);</span><br><span class="line"></span><br><span class="line">                System.out.printf(<span class="string">&quot;== 删除节点: %d\n&quot;</span>, a[i]);</span><br><span class="line">                System.out.printf(<span class="string">&quot;== 树的详细信息: \n&quot;</span>);</span><br><span class="line">                tree.print();</span><br><span class="line">                System.out.printf(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 销毁二叉树</span></span><br><span class="line">        tree.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果:<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">== 原始数据: 10 40 30 60 90 70 20 50 80 </span><br><span class="line">== 前序遍历: 30 10 20 60 40 50 80 70 90 </span><br><span class="line">== 中序遍历: 10 20 30 40 50 60 70 80 90 </span><br><span class="line">== 后序遍历: 20 10 50 40 70 90 80 60 30 </span><br><span class="line">== 最小值: 10</span><br><span class="line">== 最大值: 90</span><br><span class="line">== 树的详细信息: </span><br><span class="line">30(B) is root</span><br><span class="line">10(B) is 30&#x27;s   left child</span><br><span class="line">20(R) is 10&#x27;s  right child</span><br><span class="line">60(R) is 30&#x27;s  right child</span><br><span class="line">40(B) is 60&#x27;s   left child</span><br><span class="line">50(R) is 40&#x27;s  right child</span><br><span class="line">80(B) is 60&#x27;s  right child</span><br><span class="line">70(R) is 80&#x27;s   left child</span><br><span class="line">90(R) is 80&#x27;s  right child</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>《算法导论》</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/p/3624343.html">红黑树之 Java的实现</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">红黑树数据结构可视化</a></li>
</ul>

        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 pwxcoo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/toc/">Toc</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


<!-- mathjax -->
<script src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=default">
  MathJax.Hub.Config({
   tex2jax: {
   inlineMath: [['$','$'],["\\(","\\)"]],
   displayMath: [['\\[','\\]'], ['$$','$$']],
   },
});
</script>
<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-123052529-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'pwxcoo';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


